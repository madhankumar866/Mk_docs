server {

  listen 80;
  server_name www.domain.com;

}

server {

   listen          139.162.54.200:80;
   server_name     www.domain.com;
   root            /home/sites/domain.com;
   index           index.php;
   charset         utf-8;
   add_header Strict-Transport-Security max-age=31536000;
        server_tokens off;

        keepalive_timeout 90;

        keepalive_requests 100000;

        sendfile on;

        tcp_nopush on;

        tcp_nodelay on;

        chunked_transfer_encoding       off;

        client_max_body_size 32m;

        client_body_buffer_size 512k;

        client_header_buffer_size    1k;

        large_client_header_buffers  4 4k;

        output_buffers               1 32k;

        postpone_output              1460;

        client_header_timeout  3m;

        client_body_timeout    3m;

        send_timeout           3m;
        access_log  /var/log/nginx/domain_access.log main;

        error_log  /var/log/nginx/domain_error.log;
	rewrite ^(/actress-photos)(.*)$  http://www.domain.com/category/gallery/actress/ permanent;
        rewrite ^(/latest-tamil-cinema-news)(.*)$  http://www.domain.com/category/cinema-news/ permanent;
        rewrite ^(/movie-preview)(.*)$  http://www.domain.com/category/preview/ permanent;
        rewrite ^(/movie-review)(.*)$  http://www.domain.com/category/reviews/movie-reviews/ permanent;
        rewrite ^(/music-review)(.*)$  http://www.domain.com/category/reviews/music-reviews/ permanent;
        rewrite ^(/movie-trailers)(.*)$  http://www.domain.com/category/videos/trailers-videos/ permanent;
        rewrite ^(/short-films)(.*)$  http://www.domain.com/category/videos/short-films/ permanent;
        rewrite ^(/hot-pics)(.*)$  http://www.domain.com/category/gallery/hot-pics/ permanent;
        rewrite ^(/moviestills)(.*)$  http://www.domain.com/category/gallery/movie-stills/ permanent;
        rewrite ^(/events)(.*)$   http://www.domain.com/category/gallery/events-photos/ permanent;
        rewrite ^(/actors)(.*)$   http://www.domain.com/category/gallery/actors/ permanent;
        rewrite ^(/upcoming-movies)(.*)$   http://www.domain.com/category/upcoming-movies/ permanent;


        location = /favicon.ico {
            log_not_found off;
            access_log off;
         }


         location = /robots.txt {
            allow all;
            log_not_found off;
            access_log off;
        }


        location ~ /\. {
            deny all;
            access_log off;
            log_not_found off;
        }

   location / {

      try_files $uri $uri/ index.php;
   }


rewrite /wp-admin$ $scheme://$host$uri/ permanent;   
        ###Cache Purpose##
        location ~* ^.+\.(css|js)$ {
        rewrite ^(.+)\.(\d+)\.(css|js)$ $1.$3 last;
        expires 31536000s;
        access_log off;
        log_not_found off;
        add_header Pragma public;
        add_header Cache-Control "max-age=31536000, public";
        }
         location ~* \.(asf|asx|wax|wmv|wmx|avi|bmp|class|divx|doc|docx|eot|exe|gif|gz|gzip|ico|jpg|jpeg|jpe|mdb|mid|midi|mov|qt|mp3|m4a|mp4|m4v|mpeg|mpg|mpe|mpp|odb|odc|odf|odg|odp|ods|odt|ogg|ogv|otf|pdf|png|pot|pps|ppt|pptx|ra|ram|svg|svgz|swf|tar|t?gz|tif|tiff|ttf|wav|webm|wma|woff|wri|xla|xls|xlsx|xlt|xlw|zip)$ {
        expires 31536000s;
        access_log off;
        log_not_found off;
        add_header Pragma public;
        add_header Cache-Control "max-age=31536000, public";
        }
        ###END##
         if ($uri !~ wp-content/plugins) {
        rewrite /files/(.+)$ /wp-includes/ms-files.php?file=$1 last;
        }
        if (!-e $request_filename) {
        rewrite /wp-admin$ $scheme://$host$uri/ permanent;
        rewrite ^/[_0-9a-zA-Z-]+(/wp-.*) /wp$1 last;
        rewrite ^/[_0-9a-zA-Z-]+(/.*\.php)$ /wp$1 last;
        }



    location ~ .php/ { ## Forward paths like /js/index.php/x.js to relevant handler
        rewrite ^(.*.php)/ $1 last;
    }

        open_file_cache max=1000 inactive=20s;
        open_file_cache_valid 30s;
        open_file_cache_min_uses 5;
        open_file_cache_errors off;


    location ~ .php$ { ## Execute PHP scripts
        if (!-e $request_filename) { rewrite / /index.php last; } ## Catch 404s that try_files miss
        fastcgi_param  HTTPS $fastcgi_https; 
        fastcgi_buffers 256 4k;
        fastcgi_buffer_size 256k;
        fastcgi_connect_timeout 300;
        fastcgi_send_timeout 300;
        expires        off; ## Do not cache dynamic content
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        fastcgi_param  MAGE_RUN_CODE default; ## Store code is defined in administration > Configuration > Manage Stores
        fastcgi_param  MAGE_RUN_TYPE store;
        fastcgi_read_timeout 999; 
        fastcgi_temp_file_write_size 256k;
        include        fastcgi_params; ## See /etc/nginx/fastcgi_params
    }

        location ~* /(?:uploads|files)/.*\.php$ {
        deny all;
        }

            gzip on;
            gzip_static on;
            gzip_vary on;
            gzip_comp_level 6;
            gzip_buffers     4 4k;
            gzip_types application/x-javascript text/css application/javascript text/javascript text/plain text/xml application/json application/vnd.ms-fontobject application/x-font-opentype application/x-font-truetype application/x-font-ttf application/xml font/eot font/opentype font/otf image/svg+xml image/vnd.microsoft.icon;
            gzip_disable "MSIE [1-6]\.";
            gzip_proxied    no-cache no-store private expired auth;
            gzip_min_length 1000;



}
